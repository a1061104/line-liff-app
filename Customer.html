<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ’éª¨é…¥å¯µç‰©ç¾å®¹ | æœƒå“¡ä¸­å¿ƒ</title>
    
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* (æ¨£å¼ä¿æŒä¸è®Šï¼Œç‚ºäº†ç¯€çœç¯‡å¹…ï¼Œæ­¤è™•çœç•¥ CSSï¼Œè«‹æ²¿ç”¨ä¸Šä¸€æ­¥æä¾›çš„ CSS) */
        :root { --primary-color: #06c755; --primary-dark: #05a546; --accent-color: #ff9f43; --bg-color: #f8f9fa; --card-bg: #ffffff; --text-main: #2d3436; --text-sub: #636e72; --shadow: 0 8px 24px rgba(0, 0, 0, 0.08); --radius: 20px; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; color: var(--text-main); display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        header { width: 100%; max-width: 480px; margin-bottom: 24px; text-align: center; }
        h1 { font-size: 22px; font-weight: 700; margin: 0; color: var(--text-main); display: flex; align-items: center; justify-content: center; gap: 8px; }
        #loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255,255,255,0.9); z-index: 999; display: flex; flex-direction: column; align-items: center; justify-content: center; transition: opacity 0.3s; }
        .spinner { width: 40px; height: 40px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 12px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .profile-card { background: var(--card-bg); border-radius: var(--radius); padding: 30px 20px; width: 100%; max-width: 360px; box-shadow: var(--shadow); text-align: center; margin-bottom: 24px; position: relative; overflow: hidden; display: none; flex-direction: column; align-items: center; animation: slideUp 0.5s ease-out; }
        .profile-card::before { content: ""; position: absolute; top: 0; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, var(--primary-color), var(--accent-color)); }
        .avatar-container { width: 80px; height: 80px; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 4px 10px rgba(0,0,0,0.1); overflow: hidden; margin-bottom: 12px; background-color: #eee; }
        .avatar-container img { width: 100%; height: 100%; object-fit: cover; }
        .user-name { font-size: 20px; font-weight: 700; margin-bottom: 4px; }
        .user-status { font-size: 13px; color: var(--primary-color); background: #e8f8ee; padding: 4px 12px; border-radius: 20px; font-weight: 500; display: inline-block; margin-bottom: 20px; }
        .qr-wrapper { background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #eee; margin-bottom: 10px; }
        .qr-hint { font-size: 12px; color: #999; margin-top: 8px; }
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; width: 100%; max-width: 480px; }
        .menu-item { background: var(--card-bg); border-radius: 16px; padding: 20px; text-decoration: none; color: var(--text-main); box-shadow: 0 4px 12px rgba(0,0,0,0.05); transition: transform 0.2s, box-shadow 0.2s; display: flex; flex-direction: column; align-items: center; text-align: center; border: 1px solid transparent; cursor: pointer; }
        .menu-item:active { transform: scale(0.96); }
        .menu-icon { font-size: 32px; margin-bottom: 8px; }
        .menu-title { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
        .menu-desc { font-size: 12px; color: var(--text-sub); }
        .menu-item.customer { border-bottom: 4px solid var(--primary-color); }
        .menu-item.pet { border-bottom: 4px solid var(--accent-color); }
        footer { margin-top: auto; color: #b2bec3; font-size: 12px; padding-top: 30px; text-align: center; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .error-box { color: #e74c3c; background: #fdeaea; padding: 15px; border-radius: 12px; font-size: 14px; text-align: center; width: 100%; max-width: 360px; display: none; margin-bottom: 20px; }
    </style>
</head>
<body>
    <div id="loading-overlay"><div class="spinner"></div><div style="color:#666; font-size:14px;">è®€å–æœƒå“¡è³‡æ–™ä¸­...</div></div>
    <header><h1>ğŸ¶ æ’éª¨é…¥å¯µç‰©ç¾å®¹</h1></header>
    <div id="error-box" class="error-box"></div>
    <div class="profile-card" id="profile-card">
        <div class="avatar-container"><img id="user-avatar" src="https://via.placeholder.com/150/f0f0f0/cccccc?text=User" alt="User"></div>
        <div class="user-name" id="display-name">è¼‰å…¥ä¸­...</div>
        <div class="user-status">âœ¨ ä¸€èˆ¬æœƒå“¡</div>
        <div class="qr-wrapper"><div id="qrcode"></div></div>
        <div class="qr-hint">è«‹å‘æ«ƒå°å‡ºç¤ºæ­¤ QR Code é€²è¡Œå ±åˆ°</div>
    </div>

    <div class="menu-grid">
        <div onclick="navigateTo('Customer.html')" class="menu-item customer">
            <div class="menu-icon">ğŸ™â€â™‚ï¸</div>
            <div class="menu-title">æœƒå“¡è³‡æ–™</div>
            <div class="menu-desc">ä¿®æ”¹å€‹äººè³‡è¨Š</div>
        </div>

        <div onclick="navigateTo('Pet.html')" class="menu-item pet">
            <div class="menu-icon">ğŸ•</div>
            <div class="menu-title">æ¯›å­©è³‡æ–™</div>
            <div class="menu-desc">ç®¡ç†å¯µç‰©æª”æ¡ˆ</div>
        </div>
    </div>

    <footer>&copy; 2026 æ’éª¨é…¥å¯µç‰©ç¾å®¹</footer>

    <script>
        // ==========================================
        // ğŸ”§ è¨­å®šå€ (è«‹åœ¨æ­¤è™•ä¿®æ”¹æ‚¨çš„ GitHub ç¶²å€)
        // ==========================================
        const MY_LIFF_ID = '2008965576-txfwY86y'; 
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxzciNP_1cdq9XBnfcgTj5gv_QEt2xk-cevUsocHJx5j4IxjhJvS9DHHz1hhPXzDQHl/exec';
        
        // â­ è«‹å°‡ä¸‹æ–¹ç¶²å€æ”¹æˆæ‚¨ GitHub Pages çš„å¯¦éš›ç¶²å€ â­
        // æ ¼å¼ç¯„ä¾‹ï¼š'https://æ‚¨çš„å¸³è™Ÿ.github.io/å°ˆæ¡ˆåç¨±'
        // æ³¨æ„ï¼šç¶²å€æœ€å¾Œé¢ä¸è¦åŠ æ–œç·š '/'
        const GITHUB_PAGE_URL = 'https://æ‚¨çš„å¸³è™Ÿ.github.io/æ‚¨çš„Repoåç¨±'; 

        // ==========================================

        window.onload = function() {
            if (typeof QRCode === 'undefined') { showError('éŒ¯èª¤ï¼šQR Code ç¨‹å¼åº«æœªè¼‰å…¥'); return; }
            initializeLiff();
        };

        function initializeLiff() {
            liff.init({ liffId: MY_LIFF_ID })
                .then(() => {
                    if (!liff.isLoggedIn()) { liff.login(); } 
                    else { getProfileAndCheck(); }
                })
                .catch(err => { showError('LIFF åˆå§‹åŒ–å¤±æ•—ï¼š' + err); });
        }

        function getProfileAndCheck() {
            liff.getProfile().then(profile => {
                updateProfileUI(profile);
                checkAndCreateUser(profile.userId, profile.displayName);
            }).catch(err => { showError('è®€å–å€‹äººè³‡æ–™å¤±æ•—ï¼š' + err); });
        }

        function updateProfileUI(profile) {
            document.getElementById('display-name').innerText = profile.displayName;
            if (profile.pictureUrl) document.getElementById('user-avatar').src = profile.pictureUrl;
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById("qrcode"), { text: profile.userId, width: 160, height: 160, colorDark : "#2d3436", colorLight : "#ffffff", correctLevel : QRCode.CorrectLevel.H });
            hideLoading();
        }

        function checkAndCreateUser(userId, displayName) {
            const url = `${GAS_URL}?action=user_login_check&u_id=${encodeURIComponent(userId)}&u_name=${encodeURIComponent(displayName)}`;
            fetch(url).catch(err => console.error('API Error:', err));
        }

        // ğŸš€ ä¿®æ”¹å¾Œçš„è·³è½‰å‡½å¼
        function navigateTo(fileName) {
            // æª¢æŸ¥æ˜¯å¦å·²è¨­å®š GitHub ç¶²å€
            if (GITHUB_PAGE_URL.includes('æ‚¨çš„å¸³è™Ÿ')) {
                alert('è«‹å…ˆåœ¨ index.html ç¨‹å¼ç¢¼ä¸­è¨­å®š GITHUB_PAGE_URL è®Šæ•¸ï¼');
                return;
            }

            // ç›´æ¥è·³è½‰åˆ° GitHub Pages ä¸Šçš„ HTML æª”æ¡ˆ
            // é€™è£¡ä¸éœ€è¦å¸¶åƒæ•¸ï¼Œå› ç‚ºåˆ°äº†ä¸‹ä¸€é  (Customer.html)ï¼Œè©²é é¢æœƒå†æ¬¡åŸ·è¡Œ liff.init() ä¾†æŠ“å–ä½¿ç”¨è€…èº«åˆ†
            window.location.href = `${GITHUB_PAGE_URL}/${fileName}`;
        }

        function hideLoading() {
            const overlay = document.getElementById('loading-overlay');
            overlay.style.opacity = '0';
            setTimeout(() => { overlay.style.display = 'none'; document.getElementById('profile-card').style.display = 'flex'; }, 300);
        }

        function showError(msg) {
            document.getElementById('loading-overlay').style.display = 'none';
            const errBox = document.getElementById('error-box');
            errBox.style.display = 'block';
            errBox.innerText = msg;
        }
    </script>
</body>
</html>
