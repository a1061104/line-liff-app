<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ’éª¨é…¥å¯µç‰©ç¾å®¹ | æœƒå“¡ä¸­å¿ƒ</title>
    
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
        /* --- ç¾ä»£åŒ– UI æ¨£å¼è¨­å®š --- */
        :root {
            --primary-color: #06c755; /* LINE ç¶  */
            --accent-color: #ff9f43;  /* å¯µç‰©æ©˜ */
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --shadow: 0 8px 24px rgba(0, 0, 0, 0.08);
            --radius: 20px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: var(--text-main);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        header { margin-bottom: 24px; text-align: center; width: 100%; }
        h1 { font-size: 24px; font-weight: 700; margin: 0; color: var(--text-main); }
        
        /* è®€å–ç•«é¢ */
        #loading-overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(255,255,255,0.95);
            z-index: 999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            transition: opacity 0.3s;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary-color); border-radius: 50%;
            animation: spin 1s linear infinite; margin-bottom: 12px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* æœƒå“¡å¡ç‰‡ */
        .profile-card {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 30px 20px;
            width: 100%; max-width: 360px;
            box-shadow: var(--shadow);
            text-align: center;
            margin-bottom: 24px;
            display: none; /* è¼‰å…¥å¾Œé¡¯ç¤º */
            flex-direction: column; align-items: center;
            animation: slideUp 0.5s ease-out;
            border-top: 6px solid var(--primary-color);
        }

        .user-name { font-size: 22px; font-weight: 700; margin-bottom: 5px; }
        .user-status { font-size: 13px; color: var(--primary-color); background: #e8f8ee; padding: 4px 12px; border-radius: 20px; font-weight: 500; display: inline-block; margin-bottom: 20px; }

        .qr-wrapper {
            background: #fff; padding: 15px; border-radius: 12px; border: 1px solid #eee; margin-bottom: 10px;
        }
        .qr-hint { font-size: 12px; color: #999; margin-top: 8px; }

        /* é¸å–®æŒ‰éˆ• */
        .menu-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 16px;
            width: 100%; max-width: 480px;
        }
        .menu-item {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            text-decoration: none;
            color: var(--text-main);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; align-items: center; text-align: center;
            border-bottom: 4px solid transparent;
            cursor: pointer;
            transition: transform 0.1s;
        }
        .menu-item:active { transform: scale(0.96); }
        .menu-icon { font-size: 32px; margin-bottom: 8px; }
        .menu-title { font-size: 16px; font-weight: 700; margin-bottom: 4px; }
        .menu-desc { font-size: 12px; color: var(--text-sub); }

        .menu-item.customer { border-bottom-color: var(--primary-color); }
        .menu-item.pet { border-bottom-color: var(--accent-color); }

        footer { margin-top: auto; color: #b2bec3; font-size: 12px; padding-top: 30px; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .error-box { color: #e74c3c; background: #fdeaea; padding: 15px; border-radius: 12px; font-size: 14px; text-align: center; width: 100%; max-width: 360px; display: none; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="loading-overlay">
        <div class="spinner"></div>
        <div>è®€å–æœƒå“¡è³‡æ–™ä¸­...</div>
    </div>

    <header><h1>ğŸ¶ æ’éª¨é…¥å¯µç‰©ç¾å®¹</h1></header>

    <div id="error-box" class="error-box"></div>

    <div class="profile-card" id="profile-card">
        <div class="user-name" id="display-name"></div>
        <div class="user-status">âœ¨ ä¸€èˆ¬æœƒå“¡</div>
        
        <div class="qr-wrapper">
            <div id="qrcode"></div>
        </div>
        <div class="qr-hint">è«‹å‘æ«ƒå°å‡ºç¤ºæ­¤ QR Code é€²è¡Œå ±åˆ°</div>
    </div>

    <div class="menu-grid">
        <div onclick="navigateTo('Customer.html')" class="menu-item customer">
            <div class="menu-icon">ğŸ™â€â™‚ï¸</div>
            <div class="menu-title">æœƒå“¡è³‡æ–™</div>
            <div class="menu-desc">ä¿®æ”¹å€‹äººè³‡è¨Š</div>
        </div>

        <div onclick="navigateTo('Pet.html')" class="menu-item pet">
            <div class="menu-icon">ğŸ•</div>
            <div class="menu-title">æ¯›å­©è³‡æ–™</div>
            <div class="menu-desc">ç®¡ç†å¯µç‰©æª”æ¡ˆ</div>
        </div>
    </div>

    <footer>&copy; 2026 æ’éª¨é…¥å¯µç‰©ç¾å®¹</footer>

    <script>
        // ==========================================
        // ğŸ”§ è¨­å®šå€ (è«‹ä¿®æ”¹é€™è£¡ï¼)
        // ==========================================
        
        // 1. æ‚¨çš„ LIFF ID (å·²å¾é™„ä»¶å¡«å…¥)
        const MY_LIFF_ID = '2008965576-txfwY86y'; 
        
        // 2. æ‚¨çš„ GAS å¾Œç«¯ç¶²å€ (å·²å¾é™„ä»¶å¡«å…¥)
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbxzciNP_1cdq9XBnfcgTj5gv_QEt2xk-cevUsocHJx5j4IxjhJvS9DHHz1hhPXzDQHl/exec';

        // 3. â­ è«‹å¡«å…¥æ‚¨çš„ GitHub Pages ç¶²å€ â­ (é‡è¦ï¼)
        // ç¯„ä¾‹ï¼š'https://æ‚¨çš„å¸³è™Ÿ.github.io/æ‚¨çš„å°ˆæ¡ˆå'
        // è«‹ç¢ºä¿æœ€å¾Œé¢ã€Œä¸è¦ã€åŠ æ–œç·š '/'
        const GITHUB_PAGE_URL = 'https://a1061104.github.io/line-liff-app'; 

        // ==========================================

        window.onload = function() {
            if (typeof QRCode === 'undefined') {
                showError('éŒ¯èª¤ï¼šQR Code ç¨‹å¼åº«æœªè¼‰å…¥');
                return;
            }
            initializeLiff();
        };

        function initializeLiff() {
            liff.init({ liffId: MY_LIFF_ID })
                .then(() => {
                    if (!liff.isLoggedIn()) {
                        liff.login();
                    } else {
                        // å–å¾—ä½¿ç”¨è€…è³‡æ–™
                        liff.getProfile().then(profile => {
                            updateUI(profile);
                            // èƒŒæ™¯åŸ·è¡Œå¾Œç«¯æª¢æŸ¥
                            checkAndCreateUser(profile.userId, profile.displayName);
                        }).catch(err => showError('è®€å–å¤±æ•—ï¼š' + err));
                    }
                })
                .catch(err => showError('LIFF åˆå§‹åŒ–éŒ¯èª¤ï¼š' + err));
        }

        // æ›´æ–°ä»‹é¢ (é¡¯ç¤ºåå­—èˆ‡ QR Code)
        function updateUI(profile) {
            document.getElementById('display-name').innerText = profile.displayName;
            
            // ç”¢ç”Ÿ QR Code
            document.getElementById('qrcode').innerHTML = '';
            new QRCode(document.getElementById("qrcode"), {
                text: profile.userId,
                width: 160,
                height: 160,
                colorDark : "#2d3436",
                colorLight : "#ffffff",
                correctLevel : QRCode.CorrectLevel.H
            });

            // é—œé–‰è®€å–å‹•ç•«ï¼Œé¡¯ç¤ºå…§å®¹
            document.getElementById('loading-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('loading-overlay').style.display = 'none';
                document.getElementById('profile-card').style.display = 'flex';
            }, 300);
        }

        // èƒŒæ™¯å‘¼å« GAS API
        function checkAndCreateUser(userId, displayName) {
            const url = `${GAS_URL}?action=user_login_check&u_id=${encodeURIComponent(userId)}&u_name=${encodeURIComponent(displayName)}`;
            fetch(url).catch(err => console.log('API é€£ç·šå•é¡Œ (ä¸å½±éŸ¿é¡¯ç¤º):', err));
        }

        // ğŸš€ é é¢è·³è½‰å‡½å¼ (ä¿®æ­£é€£çµå•é¡Œçš„æ ¸å¿ƒ)
        function navigateTo(fileName) {
            // æª¢æŸ¥æ˜¯å¦å¿˜äº†è¨­å®š GitHub ç¶²å€
            if (GITHUB_PAGE_URL.includes('a1061104')) {
                alert('è«‹å…ˆæ‰“é–‹ index.html ç¨‹å¼ç¢¼ï¼Œä¿®æ”¹ç¬¬ 170 è¡Œçš„ GITHUB_PAGE_URLï¼');
                return;
            }
            
            // çµ„åˆå®Œæ•´ç¶²å€ä¸¦è·³è½‰
            const fullUrl = `${GITHUB_PAGE_URL}/${fileName}`;
            window.location.href = fullUrl;
        }

        function showError(msg) {
            document.getElementById('loading-overlay').style.display = 'none';
            const box = document.getElementById('error-box');
            box.style.display = 'block';
            box.innerText = msg;
        }
    </script>
</body>
</html>
